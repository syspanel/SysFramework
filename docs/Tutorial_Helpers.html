<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Tutorial sobre funções do arquivo helpers.php em PHP.">
    <title>Tutorial de Helpers em PHP</title>

    <!-- Bootstrap core CSS -->
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/5.1.3/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Custom CSS -->
    <style>
      body {
        padding-top: 2rem;
        background-color: #f5f5f5;
      }
      .container {
        max-width: 900px;
        background-color: #fff;
        padding: 2rem;
        border-radius: .5rem;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      }
      .code-block {
        background-color: #e9ecef;
        border: 1px solid #dee2e6;
        border-radius: .25rem;
        padding: 1rem;
        overflow-x: auto;
        white-space: pre-wrap;
        font-size: 0.875rem;
        line-height: 1.5;
      }
      .alert-info {
        background-color: #e9f5fe;
        border-color: #b3d9ff;
        color: #004085;
      }
      h2 {
        margin-top: 2rem;
        border-bottom: 2px solid #007bff;
        padding-bottom: .5rem;
        color: #007bff;
      }
      .footer {
        margin-top: 2rem;
        padding: 1rem;
        text-align: center;
        font-size: 0.875rem;
        color: #6c757d;
      }
      pre code {
        font-size: 0.875rem;
      }
    </style>
  </head>
  <body>

    <div class="container">
      <h1 class="my-4 text-primary">Tutorial: Funções do Arquivo <code>helpers.php</code></h1>
      
      <div class="alert alert-info">
        Este tutorial explica as funções definidas no seu arquivo <code>helpers.php</code>, como usá-las e fornece exemplos práticos.
      </div>

      <h2>1. Função <code>asset()</code></h2>
      <p>Gera a URL para um arquivo de asset (CSS, JS, imagens, etc.).</p>
      <div class="code-block">
        <pre><code>function asset($path) {
    $baseUrl = rtrim($_SERVER['REQUEST_SCHEME'] . '://' . $_SERVER['HTTP_HOST'], '/');
    return $baseUrl . '/' . ltrim($path, '/');
}
        </code></pre>
      </div>
      <p><strong>Uso:</strong></p>
      <div class="code-block">
        <pre><code>&lt;link href="&lt;?php echo asset('css/bootstrap.min.css'); ?&gt;" rel="stylesheet"&gt;</code></pre>
      </div>

      <h2>2. Função <code>url()</code></h2>
      <p>Gera a URL completa para uma rota nomeada.</p>
      <div class="code-block">
        <pre><code>function url($name, $params = []) {
    if (!isset(Core\SysRouter::$namedRoutes[$name])) {
        throw new Exception("Route name not found: {$name}");
    }

    $route = Core\SysRouter::$namedRoutes[$name];
    $path = $route['path'];

    foreach ($params as $key => $value) {
        $path = str_replace('{' . $key . '}', $value, $path);
    }

    return asset($path);
}
        </code></pre>
      </div>
      <p><strong>Uso:</strong></p>
      <div class="code-block">
        <pre><code>&lt;a href="&lt;?php echo url('profile.show', ['id' => 1]); ?&gt;"&gt;Ver Perfil&lt;/a&gt;</code></pre>
      </div>

      <h2>3. Função <code>sanitizeMiddleware()</code></h2>
      <p>Sanitiza os dados de entrada de requisições <code>$_POST</code>, <code>$_GET</code>, e <code>$_REQUEST</code>.</p>
      <div class="code-block">
        <pre><code>function sanitizeMiddleware() {
    $_POST = SysSanitize::sanitize($_POST);
    $_GET = SysSanitize::sanitize($_GET);
    $_REQUEST = SysSanitize::sanitize($_REQUEST);
}
        </code></pre>
      </div>

      <h2>4. Função <code>loadConfig()</code></h2>
      <p>Carrega arquivos de configuração e retorna um array associativo com as configurações.</p>
      <div class="code-block">
        <pre><code>function loadConfig($filePath) {
    if (!file_exists($filePath)) {
        throw new Exception("Config file not found: $filePath");
    }
    
    $ext = pathinfo($filePath, PATHINFO_EXTENSION);
    
    switch ($ext) {
        case 'php':
            return include $filePath;
        case 'ini':
            return parse_ini_file($filePath, true);
        default:
            throw new Exception("Unsupported config file format: $ext");
    }
}
        </code></pre>
      </div>
      <p><strong>Uso:</strong></p>
      <div class="code-block">
        <pre><code>$config = loadConfig('/path/to/config.php');</code></pre>
      </div>

      <h2>5. Função <code>sanitize()</code></h2>
      <p>Limpa e escapa um input para evitar injeções de código e ataques XSS.</p>
      <div class="code-block">
        <pre><code>function sanitize($data) {
    return htmlspecialchars(strip_tags(trim($data)), ENT_QUOTES, 'UTF-8');
}
        </code></pre>
      </div>
      <p><strong>Uso:</strong></p>
      <div class="code-block">
        <pre><code>$userInput = "&lt;script&gt;alert('Hacked!');&lt;/script&gt;";
$cleanInput = sanitize($userInput);
        </code></pre>
      </div>

      <h2>6. Função <code>redirect()</code></h2>
      <p>Redireciona para uma URL específica com um código de status HTTP.</p>
      <div class="code-block">
        <pre><code>function redirect($url, $statusCode = 302) {
    header("Location: $url", true, $statusCode);
    exit();
}
        </code></pre>
      </div>
      <p><strong>Uso:</strong></p>
      <div class="code-block">
        <pre><code>redirect('/home');</code></pre>
      </div>

      <h2>7. Função <code>logError()</code></h2>
      <p>Registra mensagens de erro em um arquivo de log.</p>
      <div class="code-block">
        <pre><code>function logError($message, $file = 'error.log') {
    $timestamp = date('Y-m-d H:i:s');
    $message = "[{$timestamp}] ERROR: {$message}\n";
    file_put_contents($file, $message, FILE_APPEND);
}
        </code></pre>
      </div>
      <p><strong>Uso:</strong></p>
      <div class="code-block">
        <pre><code>logError('Database connection failed');</code></pre>
      </div>

      <h2>8. Função <code>baseUrl()</code></h2>
      <p>Gera a URL base para arquivos e recursos.</p>
      <div class="code-block">
        <pre><code>function baseUrl($path = '') {
    $baseUrl = "http://".$_SERVER['HTTP_HOST']."/";
    return $baseUrl . ltrim($path, '/');
}
        </code></pre>
      </div>
      <p><strong>Uso:</strong></p>
      <div class="code-block">
        <pre><code>echo baseUrl('assets/css/style.css');</code></pre>
      </div>

      <h2>9. Função <code>startSecureSession()</code></h2>
      <p>Inicia uma sessão segura com configurações apropriadas.</p>
      <div class="code-block">
        <pre><code>function startSecureSession() {
    if (session_status() == PHP_SESSION_NONE) {
        ini_set('session.use_only_cookies', 1);
        $secure = isset($_SERVER['HTTPS']);
        session_set_cookie_params(0, '/', '', $secure, true);
        session_start();
    }
}
        </code></pre>
      </div>
      <p><strong>Uso:</strong></p>
      <div class="code-block">
        <pre><code>startSecureSession();</code></pre>
      </div>

      <h2>10. Função <code>generateRandomString()</code></h2>
      <p>Gera uma string aleatória com comprimento especificado.</p>
      <div class="code-block">
        <pre><code>function generateRandomString($length = 10) {
    $characters = '0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ';
    $charactersLength = strlen($characters);
    $randomString = '';
    for ($i = 0; $i &lt; $length; $i++) {
        $randomString .= $characters[rand(0, $charactersLength - 1)];
    }
    return $randomString;
}
        </code></pre>
      </div>
      <p><strong>Uso:</strong></p>
      <div class="code-block">
        <pre><code>echo generateRandomString(16);</code></pre>
      </div>

      <h2>11. Função <code>createPage()</code></h2>
      <p>Cria uma estrutura básica de página com título e conteúdo.</p>
      <div class="code-block">
        <pre><code>function createPage($title, $content) {
    return [
        'title' => $title,
        'content' => $content
    ];
}
        </code></pre>
      </div>
      <p><strong>Uso:</strong></p>
      <div class="code-block">
        <pre><code>$page = createPage('Home Page', '&lt;p&gt;Welcome to the home page!&lt;/p&gt;');</code></pre>
      </div>

      <h2>12. Função <code>renderView()</code></h2>
      <p>Renderiza uma view usando o Twig template engine.</p>
      <div class="code-block">
        <pre><code>function renderView($templateName, $data = []) {
    $twig = getTwigEnvironment();
    echo $twig->render($templateName . '.html.twig', $data);
}
        </code></pre>
      </div>

      <h2>13. Funções <code>encrypt()</code> e <code>decrypt()</code></h2>
      <p>Criptografa e descriptografa dados usando o algoritmo AES-256-CBC.</p>
      <div class="code-block">
        <pre><code>function encrypt($data, $key) {
    return openssl_encrypt($data, 'aes-256-cbc', $key, 0, str_repeat('0', 16));
}

function decrypt($data, $key) {
    return openssl_decrypt($data, 'aes-256-cbc', $key, 0, str_repeat('0', 16));
}
        </code></pre>
      </div>
      <p><strong>Uso:</strong></p>
      <div class="code-block">
        <pre><code>$encrypted = encrypt('secret', 'my_key');
echo decrypt($encrypted, 'my_key');
        </code></pre>
      </div>

      <h2>14. Função <code>autoload()</code></h2>
      <p>Auto-carrega classes localizadas na pasta <code>core/</code>.</p>
      <div class="code-block">
        <pre><code>function autoload($className) {
    $classPath = __DIR__ . '/../core/' . $className . '.php';
    if (file_exists($classPath)) {
        require_once $classPath;
    }
}

spl_autoload_register('autoload');
        </code></pre>
      </div>

      <h2>15. Função <code>formatCurrency()</code></h2>
      <p>Formata valores monetários para uma representação de moeda.</p>
      <div class="code-block">
        <pre><code>function formatCurrency($amount, $currencySymbol = 'R$', $decimals = 2, $decimalSeparator = ',', $thousandsSeparator = '.') {
    if (!is_numeric($amount)) {
        throw new InvalidArgumentException("The amount must be a number.");
    }

    $formattedAmount = number_format($amount, $decimals, $decimalSeparator, $thousandsSeparator);
    return $currencySymbol . ' ' . $formattedAmount;
}
        </code></pre>
      </div>
      <p><strong>Uso:</strong></p>
      <div class="code-block">
        <pre><code>echo formatCurrency(2500); // Output: R$ 2.500,00
echo formatCurrency(2500, '$', 2, '.', ','); // Output: $ 2,500.00
        </code></pre>
      </div>

      <h2>16. Função <code>formatToTwoDecimals()</code></h2>
      <p>Formata um número para ter exatamente duas casas decimais.</p>
      <div class="code-block">
        <pre><code>function formatToTwoDecimals($number) {
    if (!is_numeric($number)) {
        throw new InvalidArgumentException("The input must be a number.");
    }

    return number_format($number, 2, '.', '');
}
        </code></pre>
      </div>
      <p><strong>Uso:</strong></p>
      <div class="code-block">
        <pre><code>echo formatToTwoDecimals(45.6789);  // Output: 45.68
        </code></pre>
      </div>

      <h2>17. Função <code>daysBetweenDates()</code></h2>
      <p>Calcula o número de dias entre duas datas.</p>
      <div class="code-block">
        <pre><code>function daysBetweenDates($date1, $date2) {
    $date1 = new DateTime($date1);
    $date2 = new DateTime($date2);
    $interval = $date1->diff($date2);
    return abs($interval->days);
}
        </code></pre>
      </div>
      <p><strong>Uso:</strong></p>
      <div class="code-block">
        <pre><code>echo daysBetweenDates('2025-08-01', '2025-08-30');  // Output: 29
        </code></pre>
      </div>

      <h2>18. Função <code>minutesBetweenEvents()</code></h2>
      <p>Calcula o número de minutos entre dois eventos.</p>
      <div class="code-block">
        <pre><code>function minutesBetweenEvents($event1, $event2) {
    $dateTime1 = new DateTime($event1);
    $dateTime2 = new DateTime($event2);
    $interval = $dateTime1->diff($dateTime2);
    $minutes = ($interval->days * 24 * 60) + ($interval->h * 60) + $interval->i;
    return $minutes;
}
        </code></pre>
      </div>
      <p><strong>Uso:</strong></p>
      <div class="code-block">
        <pre><code>$event1 = '2025-08-30 14:00:00';
$event2 = '2025-08-30 16:30:00';
echo minutesBetweenEvents($event1, $event2);  // Output: 150
        </code></pre>
      </div>

    </div>

    <footer class="footer">
      <p>&copy; 2025 Tutorial de PHP. Todos os direitos reservados.</p>
    </footer>

    <!-- Bootstrap Bundle with Popper -->
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/5.1.3/js/bootstrap.bundle.min.js"></script>
  </body>
</html>
